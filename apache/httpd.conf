# Carga los módulos necesarios para el proxy
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule headers_module modules/mod_headers.so
LoadModule rewrite_module modules/mod_rewrite.so

# Configuración del proxy
<VirtualHost *:80>
    ServerName localhost

    # Proxy para el Backend (API de Django)
    # Todas las peticiones a /api/ se redirigen a Django
    ProxyPass /api/ http://backend:8000/
    ProxyPassReverse /api/ http://backend:8000/

    # Proxy para el Frontend (React App)
    # Todas las demás peticiones se redirigen a React
    ProxyPass / http://frontend:3000/
    ProxyPassReverse / http://frontend:3000/

    # Necesario para que funcionen las WebSockets de React Dev Server
    RewriteEngine on
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://frontend:3000/$1" [P,L]

</VirtualHost>

# Para la configuración segura (HTTPS), 
# necesitarías un bloque <VirtualHost *:443>
# con SSLEngine on y las rutas a tus certificados (SSLCertificateFile, etc.)
# Para esta entrega, puedes usar un certificado autofirmado.